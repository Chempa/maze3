window.__require=function t(e,o,i){function s(r,n){if(!o[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!n&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var h=o[r]={exports:{}};e[r][0].call(h.exports,function(t){return s(e[r][1][t]||t)},h,h.exports,t,e,o,i)}return o[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)s(i[r]);return s}({arrow:[function(t,e,o){"use strict";cc._RF.push(e,"46bd49/pWRDKI8AqziJbZas","arrow"),cc.Class({extends:cc.Component,properties:{actionDistance:20,actionDuration:0},setArrowAction:function(){var t=cc.moveTo(this.actionDuration,cc.v2(0,this.actionDistance)),e=cc.moveTo(this.actionDuration,cc.v2(0,-this.actionDistance));return cc.repeatForever(cc.sequence(t,e))},onLoad:function(){this.arrowAction=this.setArrowAction(),this.node.runAction(this.arrowAction)},start:function(){}}),cc._RF.pop()},{}],background:[function(t,e,o){"use strict";cc._RF.push(e,"e3041WGnv9B1pcsnCAED7vC","background"),cc.Class({extends:cc.Component,properties:{Joint:{default:null,type:cc.Prefab},boardPerRow:0,boardHeight:0},onLoad:function(){},refresh:function(){this.node.width=this.boardPerRow*this.boardHeight+20,this.node.height=this.boardPerRow*this.boardHeight+20,this.node.x=this.node.width/2-this.boardHeight/2-10,this.node.y=this.node.height/2-this.boardHeight/2-10;for(var t=0;t<=this.boardPerRow;t++)for(var e=0;e<=this.boardPerRow;e++){var o=cc.instantiate(this.Joint);this.node.addChild(o),o.x=e*this.boardHeight-this.node.width/2+10,o.y=t*this.boardHeight-this.node.width/2+10}},start:function(){},update:function(t){}}),cc._RF.pop()},{}],board:[function(t,e,o){"use strict";cc._RF.push(e,"09e35rABRhAcbyUPvGSe+fM","board"),cc.Class({extends:cc.Component,properties:{cmd:-1,left:{default:null,type:cc.Node},right:{default:null,type:cc.Node},down:{default:null,type:cc.Node},up:{default:null,type:cc.Node},noWall:0,Wall:255},init:function(){-1!=this.cmd&&(8&this.cmd?(this.up.opacity=this.Wall,this.up.zIndex=cc.macro.MAX_ZINDEX):this.up.opacity=this.noWall,4&this.cmd?(this.right.opacity=this.Wall,this.right.zIndex=cc.macro.MAX_ZINDEX):this.right.opacity=this.noWall,2&this.cmd?(this.down.opacity=this.Wall,this.down.zIndex=cc.macro.MAX_ZINDEX):this.down.opacity=this.noWall,1&this.cmd?(this.left.opacity=this.Wall,this.left.zIndex=cc.macro.MAX_ZINDEX):this.left.opacity=this.noWall)},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],game:[function(t,e,o){"use strict";cc._RF.push(e,"63a3cN2So9JFpBDLcl5BJ89","game"),cc.Class({extends:cc.Component,properties:{levelData:{default:null,visible:!1}},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],home:[function(t,e,o){"use strict";cc._RF.push(e,"52678vsmLFMpKhi1JiA7BTf","home"),cc.Class({extends:cc.Component,properties:{},playClicked:function(){cc.director.loadScene("level")},settingsClicked:function(){cc.director.loadScene("workarea")},helpClicked:function(){cc.director.loadScene("workarea")},start:function(){}}),cc._RF.pop()},{}],levelcomplete:[function(t,e,o){"use strict";cc._RF.push(e,"4d130/CIjxPl7NmF8gdvqNg","levelcomplete"),cc.Class({extends:cc.Component,properties:{},nextClicked:function(t){cc.director.loadScene("level")},retryClicked:function(t){cc.director.loadScene("workarea")},start:function(){this.node.zIndex=cc.macro.MAX_ZINDEX}}),cc._RF.pop()},{}],level:[function(t,e,o){"use strict";cc._RF.push(e,"d297b+B+a9JyImi16RG1+Gi","level"),cc.Class({extends:cc.Component,properties:{Scroll:{default:null,type:cc.Node},Timer:{default:null,type:cc.Node},Moves:{default:null,type:cc.Node},LevelNumber:{default:null,type:cc.Node},levelData:{default:null,visible:!1}},createNewData:function(){for(var t=[],e=0;e<18;e++){t.push({unlocked:!1,bestMoves:-1,bestTimer:"0:0:0"})}return t[0].unlocked=!0,t},saveGameData:function(){var t={};if(t.settings=settings,t.levelStatus=levelStatus,cc.sys.isNative){var e=jsb.fileUtils.getWritablePath();cc.log("saving "+e),jsb.fileUtils.writeToFile({data:JSON.stringify(t)},e+levelDataFileName)?cc.log("save suc"):cc.log("save FAILED")}else cc.sys.localStorage.setItem(levelDataFileName,JSON.stringify(t))},loadGameData:function(){if(cc.sys.isNative){cc.log("loading game data");var t=jsb.fileUtils.getWritablePath();if(jsb.fileUtils.isFileExist(t+levelDataFileName)){var e=jsb.fileUtils.getValueMapFromFile(t+SS.levelDataFileName);(i=JSON.parse(e.data))&&cc.log("game data found "+i.levelStatus.length)}else cc.log("no saved game data found")}else{var o=cc.sys.localStorage.getItem(SS.levelDataFileName);if(null!=o)var i=JSON.parse(o)}},backClicked:function(t){cc.director.loadScene("home"),t.stopPropagation()},levelBack:function(t){t.stopPropagation(),this.Scroll.active=!1},levelPlay:function(t){cc.director.loadScene("workarea")},levelClicked:function(t,e){this.levelData[e-1].unlocked&&(this.LevelNumber.getComponent(cc.Label).string=e,-1==this.levelData[e-1].bestMoves?(this.Timer.getComponent(cc.Label).string="???",this.Moves.getComponent(cc.Label).string="???"):(this.Timer.getComponent(cc.Label).string=this.levelData[e-1].bestTimer,this.Moves.getComponent(cc.Label).string=String(this.levelData[e-1].bestMoves)),this.Scroll.active=!0),console.log(e)},onLoad:function(){this.levelData=this.createNewData()},start:function(){}}),cc._RF.pop()},{}],lvcell:[function(t,e,o){"use strict";cc._RF.push(e,"be474edD0lKr4Q1Z7sW/qlj","lvcell"),cc.Class({extends:cc.Component,properties:{root:{default:null,type:cc.Node},levelNumber:0},onLoad:function(){this.levelNumber=this.node.getComponent(cc.Button).clickEvents[0].customEventData,this.root.getComponent("level").levelData[this.levelNumber-1].unlocked?(this.node.getChildByName("btn").active=!0,this.node.getChildByName("lockwrap").active=!1):(this.node.getChildByName("btn").active=!1,this.node.getChildByName("lockwrap").active=!0)},start:function(){}}),cc._RF.pop()},{}],pausemenu:[function(t,e,o){"use strict";cc._RF.push(e,"99b6a6ybvBP/6jD3oBIMQWD","pausemenu"),cc.Class({extends:cc.Component,properties:{PauseMenu:{default:null,type:cc.Node}},pauseClicked:function(t){this.node.getComponent("player").gamePaused=!0,console.log("Pause"),this.PauseMenu.active=!0,t.stopPropagation()},resumeClicked:function(t){this.PauseMenu.active=!1,this.node.getComponent("player").gamePaused=!1,t.stopPropagation()},restartClicked:function(t){cc.director.loadScene("workarea"),t.stopPropagation()},settingsClicked:function(t){t.stopPropagation()},quitClicked:function(t){t.stopPropagation(),cc.director.loadScene("home")},start:function(){}}),cc._RF.pop()},{}],player:[function(t,e,o){"use strict";cc._RF.push(e,"02bdbcSX31KfLn/OKJ7/Mo4","player"),cc.Class({extends:cc.Component,properties:{Scroll:{default:null,type:cc.Node},Timer2:{default:null,type:cc.Node},Moves2:{default:null,type:cc.Node},Wrapper1:{default:null,type:cc.Node},Wrapper2:{default:null,type:cc.Node},Wrapper3:{default:null,type:cc.Node},World:{default:null,type:cc.Node},Timer:{default:null,type:cc.Node},Moves:{default:null,type:cc.Node},PlayerRotar:{default:null,type:cc.Node},Star:{default:null,type:cc.Prefab},Foot:{default:null,type:cc.Prefab},Background:{default:null,type:cc.Node},Camera:{default:null,type:cc.Node},Board:{default:null,type:cc.Prefab},gridData:{default:null,visible:!1},JsonData:{default:null,type:cc.JsonAsset},boardPool:{default:null,visible:!1},starNode:{default:null,visible:!1},up:!1,down:!1,right:!1,left:!1,gamePaused:!0,completed:!1,started:!1,timerCount:0,movesCount:0,discoveredStars:0,rotateDuration:.1,moveDuration:.2,boardHeight:150,gridPosPlayer_X:0,gridPosPlayer_Y:0,boardPerRow:0,noWall:0,Wall:255,looked:{default:!1,visible:!1},Rules:{default:null,visible:!1},Relations:{default:null,visible:!1}},calDuration:function(){var t=this.starNode.getPosition();return this.node.position.sub(t).mag()/this.boardHeight*this.moveDuration},setLookAction:function(){this.node.getChildByName("MenuBar").opacity=0;var t=this.calDuration();return cc.moveTo(t,cc.v2(this.gridPosStar_X*this.boardHeight,this.gridPosStar_Y*this.boardHeight))},unLook:function(){this.Camera.stopAllActions(),this.node.getChildByName("MenuBar").opacity=255;var t=cc.moveTo(.2,cc.v2(this.node.x,this.node.y)),e=cc.callFunc(function(){this.looked=!1},this),o=cc.sequence(t,e);this.Camera.runAction(o),this.World.x=this.node.x,this.World.y=this.node.y},lookClicked:function(){this.looked=!0;var t=this.setLookAction();this.Camera.runAction(t)},fetchBoard:function(){var t=null;return this.boardPool.size()>0?t=this.boardPool.get():(t=cc.instantiate(this.Board),console.log("Create a new board instance")),t},returnBoard:function(t){this.boardPool.put(t)},onKeyDown:function(t){switch(t.keyCode){case cc.macro.KEY.right:this.right=!0;break;case cc.macro.KEY.left:this.left=!0;break;case cc.macro.KEY.up:this.up=!0;break;case cc.macro.KEY.down:this.down=!0}t.stopPropagation()},onKeyUp:function(t){switch(t.keyCode){case cc.macro.KEY.right:this.right=!1;break;case cc.macro.KEY.left:this.left=!1;break;case cc.macro.KEY.up:this.up=!1;break;case cc.macro.KEY.down:this.down=!1}t.stopPropagation()},startTimer:function(){this.schedule(function(t){if(this.started&&!this.completed&&!this.gamePaused){this.timerCount+=1;var e=this.timerCount,o=Math.floor(e/3600);e=this.timerCount%3600;var i=Math.floor(e/60);e%=60,this.Timer.getComponent(cc.Label).string=String(o)+":"+String(i)+":"+String(e)}},1)},toDegree:function(t){return t*(180/Math.PI)},calcAngle:function(){var t=this.gridPosPlayer_X,e=this.gridPosPlayer_Y,o=this.gridPosStar_X,i=this.gridPosStar_Y;if(t==o)return e>i?180:0;if(e==i)return t>o?270:90;if(o<t&&i<e){console.log("State 1");var s=Math.abs(t-o),a=Math.abs(e-i);return 180+this.toDegree(Math.atan(s/a))}if(o>t&&i<e){console.log("State 2");s=Math.abs(e-i),a=Math.abs(t-o);return this.toDegree(Math.atan(s/a))+90}if(o>t&&i>e){console.log("State 3");s=Math.abs(t-o),a=Math.abs(e-i);return this.toDegree(Math.atan(s/a))}if(o<t&&i>e){console.log("State 4");s=Math.abs(e-i),a=Math.abs(t-o);return 270+this.toDegree(Math.atan(s/a))}return null},isValidMove:function(t){var e=this.gridPosPlayer_X,o=this.gridPosPlayer_Y,i=String(e)+","+String(o),s=this.gridData[i];return"u"==t?!(o-1<0)&&s.getChildByName("up").opacity==this.noWall:"d"==t?!(o+1>this.boardPerRow-1)&&s.getChildByName("down").opacity==this.noWall:"r"==t?!(e+1>this.boardPerRow-1)&&s.getChildByName("right").opacity==this.noWall:"l"==t&&(!(e-1<0)&&s.getChildByName("left").opacity==this.noWall)},pointToStar:function(){var t=this.calcAngle(),e=cc.rotateTo(this.rotateDuration,t);this.PlayerRotar.runAction(e)},placeFoot:function(t){if(this.started=!0,!this.completed){var e=this.gridPosPlayer_X.toString()+","+this.gridPosPlayer_Y.toString();e in this.foots?this.foots[e].rotation=t:(this.foots[e]=cc.instantiate(this.Foot),this.foots[e].rotation=t,this.node.parent.addChild(this.foots[e]),this.foots[e].x=this.node.x,this.foots[e].y=this.node.y)}},createStar:function(t,e){this.starNode=cc.instantiate(this.Star),this.node.parent.addChild(this.starNode),this.starNode.x=t*this.boardHeight,this.starNode.y=e*this.boardHeight},restStar:function(t,e,o,i){var s=cc.moveTo(this.moveDuration,cc.v2(t,e)),a=cc.callFunc(function(){this.starNode.destroy(),this.completed=!1,this.started=!1,1==this.discoveredStars?this.Wrapper1.getChildByName("star").active=!0:2==this.discoveredStars?this.Wrapper2.getChildByName("star").active=!0:3==this.discoveredStars&&(this.Wrapper3.getChildByName("star").active=!0),3!=this.discoveredStars&&(this.createStar(o,i),this.gridPosStar_X=o,this.gridPosStar_Y=i,this.pointToStar())},this),r=cc.sequence(s,a);this.starNode.runAction(r)},updateGrid:function(){this.completed||(this.movesCount+=1),this.Moves.getComponent(cc.Label).string=String(this.movesCount),this.gamePaused=!1;for(var t=this.gridPosPlayer_X,e=this.gridPosPlayer_Y,o=[],i=0;i<this.Relations[e][t].length;i++){var s=this.Relations[e][t][i][0],a=this.Relations[e][t][i][1],r=String(a)+","+String(s);o[r]=1,r in this.gridData||this.createBoard(a,s,this.Rules[s][a])}for(var n in this.gridData)n in o||(this.returnBoard(this.gridData[n]),delete this.gridData[n])},createBoard:function(t,e,o){var i=String(t)+","+String(e);this.gridData[i]=this.fetchBoard(),this.gridData[i].getComponent("board").cmd=o,this.gridData[i].getComponent("board").init(),this.node.parent.addChild(this.gridData[i]),this.gridData[i].x=t*this.boardHeight,this.gridData[i].y=e*this.boardHeight},createMoveAction:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=cc.moveTo(this.moveDuration,cc.v2(t,e)),s=cc.callFunc(function(){if(this.gridPosPlayer_X==this.gridPosStar_X&&this.gridPosPlayer_Y==this.gridPosStar_Y&&(this.completed=!0,this.started=!1,o))if(this.discoveredStars+=1,1==this.discoveredStars){var t=this.Wrapper1.getParent().convertToWorldSpaceAR(this.Wrapper1.getPosition()),e=this.starNode.getParent().convertToNodeSpaceAR(t);this.restStar(e.x,e.y,0,this.boardPerRow-1)}else if(2==this.discoveredStars){t=this.Wrapper2.getParent().convertToWorldSpaceAR(this.Wrapper2.getPosition()),e=this.starNode.getParent().convertToNodeSpaceAR(t);this.restStar(e.x,e.y,this.boardPerRow-1,0)}else if(3==this.discoveredStars){t=this.Wrapper3.getParent().convertToWorldSpaceAR(this.Wrapper3.getPosition()),e=this.starNode.getParent().convertToNodeSpaceAR(t);this.restStar(e.x,e.y,0,this.boardPerRow-1),this.starNode.opacity=0,this.Scroll.active=!0,this.Scroll.x=this.node.x,this.Scroll.y=this.node.y,this.Scroll.zIndex=cc.macro.MAX_ZINDEX,this.Timer2.getComponent(cc.Label).string=this.Timer.getComponent(cc.Label).string,this.Moves2.getComponent(cc.Label).string=this.Moves.getComponent(cc.Label).string}},this);return cc.sequence(i,s)},movePlayer:function(){if(!this.gamePaused&&!this.looked){var t=this.node.x,e=this.node.y;if(this.World.x=t,this.World.y=e,0==this.node.getNumberOfRunningActions()){if(this.down&&this.isValidMove("d")){this.placeFoot(0);var o=cc.v2(t,e+this.boardHeight);return this.node.runAction(this.createMoveAction(o.x,o.y,!1)),this.Camera.runAction(this.createMoveAction(o.x,o.y,!0)),this.gridPosPlayer_Y+=1,this.updateGrid(),void this.pointToStar()}if(this.up&&this.isValidMove("u")){this.placeFoot(180);o=cc.v2(t,e-this.boardHeight);return this.node.runAction(this.createMoveAction(o.x,o.y,!1)),this.Camera.runAction(this.createMoveAction(o.x,o.y,!0)),this.gridPosPlayer_Y-=1,this.updateGrid(),void this.pointToStar()}if(this.left&&this.isValidMove("l")){this.placeFoot(270);o=cc.v2(t-this.boardHeight,e);return this.node.runAction(this.createMoveAction(o.x,o.y,!1)),this.Camera.runAction(this.createMoveAction(o.x,o.y,!0)),this.gridPosPlayer_X-=1,this.updateGrid(),void this.pointToStar()}if(this.right&&this.isValidMove("r")){this.placeFoot(90);o=cc.v2(t+this.boardHeight,e);return this.node.runAction(this.createMoveAction(o.x,o.y,!1)),this.Camera.runAction(this.createMoveAction(o.x,o.y,!0)),this.gridPosPlayer_X+=1,this.updateGrid(),void this.pointToStar()}}}},onLoad:function(){this.boardPool=new cc.NodePool;for(var t=0;t<20;++t){var e=cc.instantiate(this.Board);this.boardPool.put(e)}var o=this.JsonData.json;this.Rules=o[0],this.Relations=o[1],this.gridData={},this.foots={},this.boardPerRow=this.Rules.length,this.updateGrid(),this.gridPosStar_X=this.Rules.length-1,this.gridPosStar_Y=this.Rules.length-1,this.createStar(this.gridPosStar_X,this.gridPosStar_Y),this.Background.getComponent("background").boardPerRow=this.boardPerRow,this.Background.getComponent("background").boardHeight=this.boardHeight,this.Background.getComponent("background").refresh(),this.node.x=this.gridPosPlayer_X*this.boardHeight,this.node.y=this.gridPosPlayer_Y*this.boardHeight,this.Camera.x=this.node.x,this.Camera.y=this.node.y,this.pointToStar(-1),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.zIndex=cc.macro.MAX_ZINDEX-10,this.gamePaused=!0,this.startTimer(),this.movesCount=0,this.Moves.getComponent(cc.Label).string=String(this.movesCount)},start:function(){this.gamePaused=!1},update:function(t){this.movePlayer()}}),cc._RF.pop()},{}],star:[function(t,e,o){"use strict";cc._RF.push(e,"bfb8di7C9ZCnbKfbXNIYeqM","star"),cc.Class({extends:cc.Component,properties:{gridPosStar_X:0,gridPosStar_Y:0,boardHeight:150},onLoad:function(){var t=cc.rotateBy(2,360),e=cc.repeatForever(t);this.node.runAction(e),this.node.x=this.gridPosStar_X*this.boardHeight,this.node.y=this.gridPosStar_Y*this.boardHeight},start:function(){}}),cc._RF.pop()},{}],touchinput:[function(t,e,o){"use strict";cc._RF.push(e,"d5f236pxZRGSawKw5vO+AIC","touchinput"),cc.Class({extends:cc.Component,properties:{Player:{default:null,type:cc.Node},previousDirection:0,touchEventCount:0,up:!1,down:!1,right:!1,left:!1},stopPlayer:function(){var t=this.Player.getComponent("player");t.down=!1,t.left=!1,t.right=!1,t.up=!1},onLoad:function(){cc.macro.ENABLE_MULTI_TOUCH=!1;var t=this.Player.getComponent("player");this.node.on("touchstart",function(e){1==t.looked&&t.unLook(),console.log("touchstart"),e.stopPropagation()},this),this.node.on("touchend",function(t){console.log("touchend"),this.stopPlayer(),t.stopPropagation()},this),this.node.on("touchcancel",function(t){console.log("touchcancel"),this.stopPlayer(),this.node.resumeSystemEvents(),t.stopPropagation()},this),this.node.on("touchmove",function(e){e.stopPropagation(),console.log("touchmove");var o=e.getLocation().y-e.getStartLocation().y,i=e.getLocation().x-e.getStartLocation().x;Math.abs(o)<50&&Math.abs(i)<10||(Math.abs(o)>Math.abs(i)?o<0?(1!=t.down&&this.stopPlayer(),t.down=!0):(1!=t.up&&this.stopPlayer(),t.up=!0):i<0?(1!=t.left&&this.stopPlayer(),t.left=!0):(1!=t.right&&this.stopPlayer(),t.right=!0))},this)},start:function(){}}),cc._RF.pop()},{}]},{},["background","board","game","home","level","levelcomplete","lvcell","arrow","pausemenu","player","star","touchinput"]);