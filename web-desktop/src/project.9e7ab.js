window.__require=function t(o,i,e){function s(r,n){if(!i[r]){if(!o[r]){var c=r.split("/");if(c=c[c.length-1],!o[c]){var h="function"==typeof __require&&__require;if(!n&&h)return h(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var d=i[r]={exports:{}};o[r][0].call(d.exports,function(t){return s(o[r][1][t]||t)},d,d.exports,t,o,i,e)}return i[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<e.length;r++)s(e[r]);return s}({arrow:[function(t,o,i){"use strict";cc._RF.push(o,"46bd49/pWRDKI8AqziJbZas","arrow"),cc.Class({extends:cc.Component,properties:{actionDistance:20,actionDuration:0},setArrowAction:function(){var t=cc.moveTo(this.actionDuration,cc.v2(0,this.actionDistance)),o=cc.moveTo(this.actionDuration,cc.v2(0,-this.actionDistance));return cc.repeatForever(cc.sequence(t,o))},onLoad:function(){this.arrowAction=this.setArrowAction(),this.node.runAction(this.arrowAction)},start:function(){}}),cc._RF.pop()},{}],background:[function(t,o,i){"use strict";cc._RF.push(o,"e3041WGnv9B1pcsnCAED7vC","background"),cc.Class({extends:cc.Component,properties:{Joint:{default:null,type:cc.Prefab},boardPerRow:0,boardHeight:0},onLoad:function(){},refresh:function(){this.node.width=this.boardPerRow*this.boardHeight+20,this.node.height=this.boardPerRow*this.boardHeight+20,this.node.x=this.node.width/2-this.boardHeight/2-10,this.node.y=this.node.height/2-this.boardHeight/2-10;for(var t=0;t<=this.boardPerRow;t++)for(var o=0;o<=this.boardPerRow;o++){var i=cc.instantiate(this.Joint);this.node.addChild(i),i.x=o*this.boardHeight-this.node.width/2+10,i.y=t*this.boardHeight-this.node.width/2+10}},start:function(){},update:function(t){}}),cc._RF.pop()},{}],board:[function(t,o,i){"use strict";cc._RF.push(o,"09e35rABRhAcbyUPvGSe+fM","board"),cc.Class({extends:cc.Component,properties:{cmd:-1,left:{default:null,type:cc.Node},right:{default:null,type:cc.Node},down:{default:null,type:cc.Node},up:{default:null,type:cc.Node},noWall:0,Wall:255},init:function(){-1!=this.cmd&&(8&this.cmd?(this.up.opacity=this.Wall,this.up.zIndex=cc.macro.MAX_ZINDEX):this.up.opacity=this.noWall,4&this.cmd?(this.right.opacity=this.Wall,this.right.zIndex=cc.macro.MAX_ZINDEX):this.right.opacity=this.noWall,2&this.cmd?(this.down.opacity=this.Wall,this.down.zIndex=cc.macro.MAX_ZINDEX):this.down.opacity=this.noWall,1&this.cmd?(this.left.opacity=this.Wall,this.left.zIndex=cc.macro.MAX_ZINDEX):this.left.opacity=this.noWall)},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],game:[function(t,o,i){"use strict";cc._RF.push(o,"63a3cN2So9JFpBDLcl5BJ89","game"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],player:[function(t,o,i){"use strict";cc._RF.push(o,"02bdbcSX31KfLn/OKJ7/Mo4","player"),cc.Class({extends:cc.Component,properties:{World:{default:null,type:cc.Node},Timer:{default:null,type:cc.Node},Moves:{default:null,type:cc.Node},PlayerRotar:{default:null,type:cc.Node},Star:{default:null,type:cc.Prefab},Foot:{default:null,type:cc.Prefab},Background:{default:null,type:cc.Node},Camera:{default:null,type:cc.Node},Board:{default:null,type:cc.Prefab},gridData:{default:null,visible:!1},JsonData:{default:null,type:cc.JsonAsset},boardPool:{default:null,visible:!1},starNode:{default:null,visible:!1},up:!1,down:!1,right:!1,left:!1,gamePaused:!0,completed:!1,timerCount:0,movesCount:0,rotateDuration:.1,moveDuration:.2,boardHeight:150,gridPosPlayer_X:0,gridPosPlayer_Y:0,boardPerRow:0,noWall:0,Wall:255,looked:{default:!1,visible:!1},Rules:{default:null,visible:!1},Relations:{default:null,visible:!1}},calDuration:function(){var t=this.starNode.getPosition();return this.node.position.sub(t).mag()/this.boardHeight*this.moveDuration},setLookAction:function(){this.node.getChildByName("MenuBar").opacity=0;var t=this.calDuration();return cc.moveTo(t,cc.v2(this.gridPosStar_X*this.boardHeight,this.gridPosStar_Y*this.boardHeight))},unLook:function(){this.Camera.stopAllActions(),this.node.getChildByName("MenuBar").opacity=255;var t=cc.moveTo(.2,cc.v2(this.node.x,this.node.y));this.Camera.runAction(t),this.World.x=this.node.x,this.World.y=this.node.y},lookClicked:function(){this.looked=!0;var t=this.setLookAction();this.Camera.runAction(t)},fetchBoard:function(){var t=null;return this.boardPool.size()>0?t=this.boardPool.get():(t=cc.instantiate(this.Board),console.log("Create a new board instance")),t},returnBoard:function(t){this.boardPool.put(t)},onKeyDown:function(t){switch(t.keyCode){case cc.macro.KEY.right:this.right=!0;break;case cc.macro.KEY.left:this.left=!0;break;case cc.macro.KEY.up:this.up=!0;break;case cc.macro.KEY.down:this.down=!0}},onKeyUp:function(t){switch(t.keyCode){case cc.macro.KEY.right:this.right=!1;break;case cc.macro.KEY.left:this.left=!1;break;case cc.macro.KEY.up:this.up=!1;break;case cc.macro.KEY.down:this.down=!1}},startTimer:function(){this.schedule(function(t){if(!this.completed&&!this.gamePaused){this.timerCount+=1;var o=this.timerCount,i=Math.floor(o/3600);o=this.timerCount%3600;var e=Math.floor(o/60);o%=60,this.Timer.getComponent(cc.Label).string=String(i)+":"+String(e)+":"+String(o)}},1)},toDegree:function(t){return t*(180/Math.PI)},calcAngle:function(){var t=this.gridPosPlayer_X,o=this.gridPosPlayer_Y,i=this.gridPosStar_X,e=this.gridPosStar_Y;if(t==i)return o>e?180:0;if(o==e)return t>i?270:90;if(i<t&&e<o){console.log("State 1");var s=Math.abs(t-i),a=Math.abs(o-e);return 180+this.toDegree(Math.atan(s/a))}if(i>t&&e<o){console.log("State 2");s=Math.abs(o-e),a=Math.abs(t-i);return this.toDegree(Math.atan(s/a))+90}if(i>t&&e>o){console.log("State 3");s=Math.abs(t-i),a=Math.abs(o-e);return this.toDegree(Math.atan(s/a))}if(i<t&&e>o){console.log("State 4");s=Math.abs(o-e),a=Math.abs(t-i);return 270+this.toDegree(Math.atan(s/a))}return null},isValidMove:function(t){var o=this.gridPosPlayer_X,i=this.gridPosPlayer_Y,e=String(o)+","+String(i),s=this.gridData[e];return"u"==t?!(i-1<0)&&s.getChildByName("up").opacity==this.noWall:"d"==t?!(i+1>this.boardPerRow-1)&&s.getChildByName("down").opacity==this.noWall:"r"==t?!(o+1>this.boardPerRow-1)&&s.getChildByName("right").opacity==this.noWall:"l"==t&&(!(o-1<0)&&s.getChildByName("left").opacity==this.noWall)},pointToStar:function(){var t=this.calcAngle(),o=cc.rotateTo(this.rotateDuration,t);this.PlayerRotar.runAction(o)},placeFoot:function(t){if(!this.completed){var o=this.gridPosPlayer_X.toString()+","+this.gridPosPlayer_Y.toString();o in this.foots?this.foots[o].rotation=t:(this.foots[o]=cc.instantiate(this.Foot),this.foots[o].rotation=t,this.node.parent.addChild(this.foots[o]),this.foots[o].x=this.node.x,this.foots[o].y=this.node.y)}},createStar:function(t,o){this.starNode=cc.instantiate(this.Star),this.node.parent.addChild(this.starNode),this.starNode.x=t*this.boardHeight,this.starNode.y=o*this.boardHeight},updateGrid:function(){this.gridPosPlayer_X==this.gridPosStar_X&&this.gridPosPlayer_Y==this.gridPosStar_Y&&(this.completed=!0),this.completed||(this.movesCount+=1),this.Moves.getComponent(cc.Label).string=String(this.movesCount),this.gamePaused=!1;for(var t=this.gridPosPlayer_X,o=this.gridPosPlayer_Y,i=[],e=0;e<this.Relations[o][t].length;e++){var s=this.Relations[o][t][e][0],a=this.Relations[o][t][e][1],r=String(a)+","+String(s);i[r]=1,r in this.gridData||this.createBoard(a,s,this.Rules[s][a])}for(var n in this.gridData)n in i||(this.returnBoard(this.gridData[n]),delete this.gridData[n])},createBoard:function(t,o,i){var e=String(t)+","+String(o);this.gridData[e]=this.fetchBoard(),this.gridData[e].getComponent("board").cmd=i,this.gridData[e].getComponent("board").init(),this.node.parent.addChild(this.gridData[e]),this.gridData[e].x=t*this.boardHeight,this.gridData[e].y=o*this.boardHeight},movePlayer:function(){if(!this.looked){var t=this.node.x,o=this.node.y;if(this.World.x=t,this.World.y=o,0==this.node.getNumberOfRunningActions()){if(this.down&&this.isValidMove("d")){this.placeFoot(0);var i=cc.moveTo(this.moveDuration,cc.v2(t,o+this.boardHeight)),e=cc.moveTo(this.moveDuration,cc.v2(t,o+this.boardHeight));return this.node.runAction(e),this.Camera.runAction(i),this.gridPosPlayer_Y+=1,this.updateGrid(),void this.pointToStar()}if(this.up&&this.isValidMove("u")){this.placeFoot(180);i=cc.moveTo(this.moveDuration,cc.v2(t,o-this.boardHeight)),e=cc.moveTo(this.moveDuration,cc.v2(t,o-this.boardHeight));return this.node.runAction(e),this.Camera.runAction(i),this.gridPosPlayer_Y-=1,this.updateGrid(),void this.pointToStar()}if(this.left&&this.isValidMove("l")){this.placeFoot(270);i=cc.moveTo(this.moveDuration,cc.v2(t-this.boardHeight,o)),e=cc.moveTo(this.moveDuration,cc.v2(t-this.boardHeight,o));return this.node.runAction(e),this.Camera.runAction(i),this.gridPosPlayer_X-=1,this.updateGrid(),void this.pointToStar()}if(this.right&&this.isValidMove("r")){this.placeFoot(90);i=cc.moveTo(this.moveDuration,cc.v2(t+this.boardHeight,o)),e=cc.moveTo(this.moveDuration,cc.v2(t+this.boardHeight,o));return this.node.runAction(e),this.Camera.runAction(i),this.gridPosPlayer_X+=1,this.updateGrid(),void this.pointToStar()}}}},onLoad:function(){this.boardPool=new cc.NodePool;for(var t=0;t<20;++t){var o=cc.instantiate(this.Board);this.boardPool.put(o)}var i=this.JsonData.json;this.Rules=i[0],this.Relations=i[1],this.gridData={},this.foots={},this.boardPerRow=this.Rules.length,this.updateGrid(),this.gridPosStar_X=this.Rules.length-1,this.gridPosStar_Y=this.Rules.length-1,this.createStar(this.gridPosStar_X,this.gridPosStar_Y),this.Background.getComponent("background").boardPerRow=this.boardPerRow,this.Background.getComponent("background").boardHeight=this.boardHeight,this.Background.getComponent("background").refresh(),this.node.x=this.gridPosPlayer_X*this.boardHeight,this.node.y=this.gridPosPlayer_Y*this.boardHeight,this.Camera.x=this.node.x,this.Camera.y=this.node.y,this.pointToStar(-1),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.zIndex=cc.macro.MAX_ZINDEX,this.gamePaused=!0,this.startTimer(),this.movesCount=0,this.Moves.getComponent(cc.Label).string=String(this.movesCount)},start:function(){},update:function(t){this.movePlayer()}}),cc._RF.pop()},{}],star:[function(t,o,i){"use strict";cc._RF.push(o,"bfb8di7C9ZCnbKfbXNIYeqM","star"),cc.Class({extends:cc.Component,properties:{gridPosStar_X:0,gridPosStar_Y:0,boardHeight:150},onLoad:function(){var t=cc.rotateBy(2,360),o=cc.repeatForever(t);this.node.runAction(o),this.node.x=this.gridPosStar_X*this.boardHeight,this.node.y=this.gridPosStar_Y*this.boardHeight},start:function(){}}),cc._RF.pop()},{}],touchinput:[function(t,o,i){"use strict";cc._RF.push(o,"d5f236pxZRGSawKw5vO+AIC","touchinput"),cc.Class({extends:cc.Component,properties:{Player:{default:null,type:cc.Node},previousDirection:0,touchEventCount:0,up:!1,down:!1,right:!1,left:!1},stopPlayer:function(){var t=this.Player.getComponent("player");t.down=!1,t.left=!1,t.right=!1,t.up=!1},onLoad:function(){cc.macro.ENABLE_MULTI_TOUCH=!1;var t=this.Player.getComponent("player");this.node.on("touchstart",function(o){1==t.looked&&(t.looked=!1,t.unLook()),console.log("touchstart"),o.stopPropagation()},this),this.node.on("touchend",function(t){console.log("touchend"),this.stopPlayer(),t.stopPropagation()},this),this.node.on("touchcancel",function(t){console.log("touchcancel"),this.stopPlayer(),this.node.resumeSystemEvents(),t.stopPropagation()},this),this.node.on("touchmove",function(o){o.stopPropagation(),console.log("touchmove");var i=o.getLocation().y-o.getStartLocation().y,e=o.getLocation().x-o.getStartLocation().x;Math.abs(i)<50&&Math.abs(e)<10||(Math.abs(i)>Math.abs(e)?i<0?(1!=t.down&&this.stopPlayer(),t.down=!0):(1!=t.up&&this.stopPlayer(),t.up=!0):e<0?(1!=t.left&&this.stopPlayer(),t.left=!0):(1!=t.right&&this.stopPlayer(),t.right=!0))},this)},start:function(){}}),cc._RF.pop()},{}]},{},["background","board","game","arrow","player","star","touchinput"]);